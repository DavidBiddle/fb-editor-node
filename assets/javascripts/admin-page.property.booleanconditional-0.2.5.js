!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}({5:function(module,exports){function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],o=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var booleanConditional=document.querySelector(".booleanConditionalOptions"),getOperator=function(e){return allowableOperators.filter((function(t){return t.operator===e}))[0]||{}},getOperatorProperty=function(e,t){return getOperator(e)[t]},getIdentifier=function(e){return allowableIdentifiers.filter((function(t){return t.name===e}))[0]||{}},getIdentifierProperty=function(e,t){return getIdentifier(e)[t]},createSelect=function(e,t,n){var o='<select name="'.concat(e,'" class="govuk-select" style="width:auto; min-width: 10rem; max-width:100%; display:block;margin-bottom: 0.5rem;"><option value=""></option>');return t.forEach((function(e){o+='<option value="'.concat(e.value,'"').concat(n===e.value?" selected":"",">").concat(e.label,"</option>")})),o+="<select>"},createIdentifier=function(e,t){var n=e.identifier,o=allowableIdentifiers.map((function(e){return{value:e.name,label:e.fullTitle}}));return createSelect("identifier===".concat(t),o,n)},asIsOperators=["boolean","date","number"],createOperator=function(e,t){var n=e.identifier,o=e.operator,a=e.type,i=e.negated;if(!n)return"";i&&(o="!".concat(o)),a=getIdentifierProperty(n,"type"),asIsOperators.includes(a)||(a="string");var r=allowableOperators.filter((function(e){if(!e.type)return!0;return("any"===e.type||e.type===a)&&!0}));return createSelect("operator===".concat(t),r,o)},createValue=function(e,t){var n=e.operator,o=e.value,a=e.enums;if(!n||"defined"===n||"isTrue"===n)return"";var i="value===".concat(t);return!a||"is"!==n&&"equals"!==n&&"defined"!==n?'<input type="text" name="'.concat(i,'" value="').concat(void 0===o?"":o,'" class="govuk-input" style="width:10em;">'):createSelect(i,a,o)},createAnswer=function(e){var t=e.identifier;return t&&t.endsWith("[*]")?"any answer for":"the answer for"},conditionsLabel={all:"all these conditions are met",any:"at least one of these conditons is met",exactly:"one of these conditions is met"},conditionsDelimiter={all:"and",any:"and/or",exactly:"or"},conditionsType=Object.keys(conditionsLabel),createConditionsType=function(e,t){var n="conditionsType===".concat(t),o=conditionsType.map((function(e){return{label:conditionsLabel[e],value:e}}));return createSelect(n,o,e)},createConditions=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,o="".concat(t,".").concat(n),a=0,i=e.map((function(t){var n="".concat(o,"[").concat(a,"]");a++;var i=1===e.length;return createCondition(t,n,i)})),r=1===e.length?'<p class="govuk-button fb-action-secondary fb-action--revert-conditions condition-action condition-revert" data-destination="'.concat(o,'" data-action="revert">Convert to single condition</p>'):"",l=createConditionsType(n,t),c='<p class="govuk-button fb-action-secondary fb-action--add fb-action--add-condition conditionsAdd" data-action="add" data-destination="'.concat(o,'">Add condition</p>');return'<div class="conditions-block">'.concat(l).concat(r,'<div class="conditions-subconditions">').concat(i.join('<p class="conditions-delimiter">'.concat(conditionsDelimiter[n],"</p>"))).concat(c,"</div></div>")},createCondition=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;if("object"!==_typeof(e))return valueControl.style.display="none","";var o=e=JSON.parse(JSON.stringify(e)),a=o.all,i=o.any,r=o.exactly;if(a)return createConditions(a,t,"all");if(i)return createConditions(i,t,"any");if(r)return createConditions(r,t,"exactly");var l=e,c=l.identifier,u=allowableIdentifiers.filter((function(e){return e.name===c})).map((function(e){return e.enums}))[0];e.enums=u;var d="";""===t||n||(d='<p class="govuk-button fb-action-secondary fb-action--remove-condition condition-action condition-remove" data-destination="'.concat(t,'" data-action="remove">Delete</p>'));var s='<p class="govuk-button fb-action-secondary fb-action--convert-condition condition-action condition-convert" data-destination="'.concat(t||"TOP",'" data-action="convert">Convert to multiple conditions</p>');return"undefined"!==c?'<div class="condition-individual">'.concat(createAnswer(e)," ").concat(createIdentifier(e,t)," ").concat(createOperator(e,t)," ").concat(createValue(e,t)).concat(d).concat(s,"</div>"):void 0};booleanConditional.insertAdjacentHTML("afterend",'<div id="conditions"></div><p id="conditionsToggle"><span class="govuk-button fb-action-secondary"></span></p>');var conditionContainer=document.querySelector("#conditions"),conditionsToggler=document.querySelector("#conditionsToggle .fb-action-secondary"),jsonMode=!1,uiImpossible=!1,updateConditions=function(e){var t=createCondition(e);void 0!==t?(uiImpossible=!1,conditionContainer.innerHTML=t,showJSONMode(jsonMode)):(uiImpossible=!0,showJSONMode(!0))},showJSONMode=function(e){jsonMode=!!e;var t="",n="none",o="Edit JSON";e&&(t="none",n="",o="Edit with UI"),uiImpossible&&(o="Cannot show JSON structure through UI"),conditionContainer.style.display=t,valueControl.style.display=n,conditionsToggler.innerHTML=o};conditionsToggler.addEventListener("click",(function(){uiImpossible||showJSONMode(!jsonMode)})),conditionContainer.addEventListener("click",(function(e){var t=e.target,n=t.getAttribute("data-destination");if(n){var o=t.getAttribute("data-action");if("add"===o)getValueDestination(n).push({});else if("remove"===o){var a;n=n.replace(/\[(\d+)\]$/,(function(e,t){return a=t,""})),getValueDestination(n).splice(a,1)}else if("convert"===o){"TOP"===n&&(n="");var i=getValueDestination(n),r=JSON.parse(JSON.stringify(i));Object.keys(i).forEach((function(e){delete i[e]})),i.all=[r]}else if("revert"===o){var l=getValueDestination(n),c=getValueDestination(n.replace(/\.[^.]+$/,""));Object.keys(c).forEach((function(e){delete c[e]})),Object.keys(l).forEach((function(e){c[e]=l[e]}))}updateConditions(value)}})),conditionContainer.addEventListener("change",(function(e){var t=e.target,n=t.value,o=_slicedToArray(t.name.split("==="),2),a=o[0],i=o[1],r=getValueDestination(i=i||"");if("identifier"===a)delete r.operator,delete r.value;else if("operator"===a)n.startsWith("!")?(n=n.substr(1),r.negated=!0):delete r.negated,"defined"!==n&&"isTrue"!==n||delete r.value;else if("conditionsType"===a){var l=[];conditionsType.forEach((function(e){r[e]&&(l=r[e],delete r[e])})),r[n]=l}if("value"===a&&""!==n&&"number"===getOperatorProperty(value.operator,"type")){var c=Number(n);isNaN(c)||(n=c)}r[a]=n,updateValueControl("condition"),updateConditions(value)}));var formElements=document.forms[0].elements,allowableOperators=[],allowableIdentifiers=JSON.parse(unescape(formElements.booleanConditional.value)).reverse(),allowableOperatorsIn=JSON.parse(unescape(formElements.allowableOperators.value));Object.entries(allowableOperatorsIn).forEach((function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1],a=o.type,i=o.yes,r=o.no;allowableOperators.push({operator:n,type:a,value:n,label:i}),allowableOperators.push({operator:n,type:a,value:"!".concat(n),label:r})}));var valueControl=formElements.value;valueControl.addEventListener("change",(function(){value=JSON.parse(valueControl.value),updateConditions(value)})),conditionContainer.parentNode.insertBefore(valueControl,conditionContainer.nextSibling);var value=valueControl.value?JSON.parse(valueControl.value):valueControl.value,getValueDestination=function getValueDestination(destination){var valueDestination;return eval("valueDestination = value".concat(destination)),valueDestination},updateValueControl=function(e){"condition"===e?(value=value||{identifier:"",operator:""},e=JSON.stringify(value,null,2)):value=void 0,valueControl.value=e},booleanConditionalNodeList=formElements.booleanConditionalOptions,typeValue="boolean"==typeof value?value.toString():"condition";"boolean"==typeof value&&(value=void 0),booleanConditionalNodeList.value=typeValue,booleanConditional.classList.remove("js-hidden");for(var index=0;index<3;index++)booleanConditionalNodeList.item(index).addEventListener("change",(function(){updateValueControl(this.value),updateConditions(value)}));"object"===_typeof(value)?updateConditions(value):valueControl.style.display="none"}});
//# sourceMappingURL=admin-page.property.booleanconditional-0.2.5.js.map