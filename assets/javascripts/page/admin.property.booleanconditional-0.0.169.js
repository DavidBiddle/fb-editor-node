!function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}({2:function(module,exports){const booleanConditional=document.querySelector(".booleanConditionalOptions");let allowableOperators,allowableIdentifiers;const getOperator=e=>allowableOperators.filter(t=>t.operator===e)[0]||{},getOperatorProperty=(e,t)=>getOperator(e)[t],getIdentifier=e=>allowableIdentifiers.filter(t=>t.name===e)[0]||{},getIdentifierProperty=(e,t)=>getIdentifier(e)[t],createSelect=(e,t,o)=>{let n=`<select name="${e}" class="govuk-select" style="width:auto; min-width: 10rem; max-width:100%; display:block;margin-bottom: 0.5rem;"><option value=""></option>`;return t.forEach(e=>{n+=`<option value="${e.value}"${o===e.value?" selected":""}>${e.label}</option>`}),n+="<select>",n},createIdentifier=(e,t)=>{const{identifier:o}=e,n=allowableIdentifiers.map(e=>({value:e.name,label:e.fullTitle}));return createSelect(`identifier===${t}`,n,o)},asIsOperators=["boolean","date","number"],createOperator=(e,t)=>{let{identifier:o,operator:n,type:i,negated:a,enums:l}=e;if(!o)return"";a&&(n=`!${n}`),i=getIdentifierProperty(o,"type"),asIsOperators.includes(i)||(i="string");const r=allowableOperators.filter(e=>{if(!e.type)return!0;return("any"===e.type||e.type===i)&&!0});return createSelect(`operator===${t}`,r,n)},createValue=(e,t)=>{let o,{identifier:n,operator:i,value:a,enums:l}=e;if(!i||"defined"===i||"isTrue"===i)return"";let r=`value===${t}`;return o=!l||"is"!==i&&"equals"!==i&&"defined"!==i?`<input type="text" name="${r}" value="${void 0===a?"":a}" class="govuk-input" style="width:10em;">`:createSelect(r,l,a),o},createAnswer=e=>{const{identifier:t}=e;return t&&t.endsWith("[*]")?"any answer for":"the answer for"},conditionsLabel={all:"all these conditions are met",any:"at least one of these conditons is met",exactly:"one of these conditions is met"},conditionsDelimiter={all:"and",any:"and/or",exactly:"or"},conditionsType=Object.keys(conditionsLabel),createConditionsType=(e,t)=>{let o=`conditionsType===${t}`,n=conditionsType.map(e=>({label:conditionsLabel[e],value:e}));return createSelect(o,n,e)},createConditions=(e,t="",o)=>{let n=t+"."+o,i=0;const a=e.map(t=>{const o=`${n}[${i}]`;i++;const a=1===e.length;return createCondition(t,o,a)}),l=1===e.length?'<p class="govuk-button fb-action-secondary fb-action--revert-conditions condition-action condition-revert" data-destination="'+n+'" data-action="revert">Convert to single condition</p>':"",r=createConditionsType(o,t),s='<p class="govuk-button fb-action-secondary fb-action--add fb-action--add-condition conditionsAdd" data-action="add" data-destination="'+n+'">Add condition</p>';return'<div class="conditions-block" >'+r+l+'<div class="conditions-subconditions">'+a.join('<p class="conditions-delimiter">'+conditionsDelimiter[o]+"</p>")+s+"</div></div>"};let valueControl;const createCondition=(e,t="",o)=>{if("object"!=typeof e)return valueControl.style.display="none","";e=JSON.parse(JSON.stringify(e));const{all:n,any:i,exactly:a}=e;if(n)return createConditions(n,t,"all");if(i)return createConditions(i,t,"any");if(a)return createConditions(a,t,"exactly");const{identifier:l,operator:r,value:s,negated:d}=e,c=allowableIdentifiers.filter(e=>e.name===l).map(e=>e.enums)[0];e.enums=c;let u="";""===t||o||(u='<p class="govuk-button fb-action-secondary fb-action--remove-condition condition-action condition-remove" data-destination="'+t+'" data-action="remove">Delete</p>');let p='<p class="govuk-button fb-action-secondary fb-action--convert-condition condition-action condition-convert" data-destination="'+(t||"TOP")+'" data-action="convert">Convert to multiple conditions</p>';return"undefined"!==l?`<div class="condition-individual">${createAnswer(e)} ${createIdentifier(e,t)} ${createOperator(e,t)} ${createValue(e,t)}${u}${p}</div>`:void 0};booleanConditional.insertAdjacentHTML("afterend",'<div id="conditions"></div><p id="conditionsToggle"><span class="govuk-button fb-action-secondary"></span></p>');const conditionContainer=document.querySelector("#conditions"),conditionsToggler=document.querySelector("#conditionsToggle .fb-action-secondary");let jsonMode=!1,uiImpossible=!1;const updateConditions=e=>{const t=createCondition(e);void 0!==t?(uiImpossible=!1,conditionContainer.innerHTML=t,showJSONMode(jsonMode)):(uiImpossible=!0,showJSONMode(!0))},showJSONMode=e=>{jsonMode=!!e;let t="",o="none",n="Edit JSON";e&&(t="none",o="",n="Edit with UI"),uiImpossible&&(n="Cannot show JSON structure through UI"),conditionContainer.style.display=t,valueControl.style.display=o,conditionsToggler.innerHTML=n};conditionsToggler.addEventListener("click",()=>{uiImpossible||showJSONMode(!jsonMode)}),conditionContainer.addEventListener("click",(function(e){const t=e.target;let o=t.getAttribute("data-destination");if(!o)return;let n=t.getAttribute("data-action");if("add"===n){getValueDestination(o).push({})}else if("remove"===n){let e;o=o.replace(/\[(\d+)\]$/,(t,o)=>(e=o,"")),getValueDestination(o).splice(e,1)}else if("convert"===n){"TOP"===o&&(o="");let e=getValueDestination(o),t=JSON.parse(JSON.stringify(e));Object.keys(e).forEach(t=>{delete e[t]}),e.all=[t]}else if("revert"===n){let e=getValueDestination(o),t=getValueDestination(o.replace(/\.[^.]+$/,""));Object.keys(t).forEach(e=>{delete t[e]}),Object.keys(e).forEach(o=>{t[o]=e[o]})}updateConditions(value)})),conditionContainer.addEventListener("change",(function(e){const t=e.target;let o=t.value,[n,i]=t.name.split("===");i=i||"";let a=getValueDestination(i);if("identifier"===n)delete a.operator,delete a.value;else if("operator"===n)o.startsWith("!")?(o=o.substr(1),a.negated=!0):delete a.negated,"defined"!==o&&"isTrue"!==o||delete a.value;else if("conditionsType"===n){let e=[];conditionsType.forEach(t=>{a[t]&&(e=a[t],delete a[t])}),a[o]=e}if("value"===n&&""!==o){if("number"===getOperatorProperty(value.operator,"type")){let e=Number(o);isNaN(e)||(o=e)}}a[n]=o,updateValueControl("condition"),updateConditions(value)}));const formElements=document.forms[0].elements;allowableIdentifiers=JSON.parse(unescape(formElements.booleanConditional.value)).reverse();const allowableOperatorsIn=JSON.parse(unescape(formElements.allowableOperators.value));allowableOperators=[],Object.keys(allowableOperatorsIn).forEach(e=>{const t=allowableOperatorsIn[e],o=t.type;allowableOperators.push({operator:e,type:o,value:e,label:t.yes}),allowableOperators.push({operator:e,type:o,value:`!${e}`,label:t.no})}),valueControl=formElements.value,valueControl.addEventListener("change",()=>{value=JSON.parse(valueControl.value),updateConditions(value)}),conditionContainer.parentNode.insertBefore(valueControl,conditionContainer.nextSibling);let value=valueControl.value?JSON.parse(valueControl.value):valueControl.value;const getValueDestination=destination=>{let valueDestination;return eval(`valueDestination = value${destination}`),valueDestination},updateValueControl=e=>{"condition"===e?(value=value||{identifier:"",operator:""},e=JSON.stringify(value,null,2)):value=void 0,valueControl.value=e},booleanConditionalNodeList=formElements.booleanConditionalOptions;let typeValue="boolean"==typeof value?value.toString():"condition";"boolean"==typeof value&&(value=void 0),booleanConditionalNodeList.value=typeValue,booleanConditional.classList.remove("js-hidden");for(let e=0;e<3;e++)booleanConditionalNodeList.item(e).addEventListener("change",(function(){updateValueControl(this.value),updateConditions(value)}));"object"==typeof value?updateConditions(value):valueControl.style.display="none"}});
//# sourceMappingURL=admin.property.booleanconditional-0.0.169.js.map